import{m as X}from"./chunk-AL4B7SPR.js";import{e as q,l as G,r as H,s as J,t as K,y as Q}from"./chunk-CZTEBDJ7.js";import{d as te}from"./chunk-3M4FKD4C.js";import{h as ee,k as ie}from"./chunk-IIKCB2AW.js";import{a as Y,b as Z}from"./chunk-IJXZOFF2.js";import{Ac as m,Ib as $,Jb as b,Ob as u,Qb as k,Rb as E,Sb as T,Tb as a,Ub as o,Vb as B,Zb as S,_c as z,a as M,ac as h,b as V,bc as c,gb as s,h as F,lc as l,ma as w,mc as g,nc as I,oc as L,qc as N,rc as P,sb as U,sc as j,ua as f,va as C,w as A,wc as O,xc as W,yb as x,zc as d}from"./chunk-N5DHAEO2.js";var se=(t,r)=>({"btn-danger":t,"btn-elegant":r}),ae=(t,r,e)=>({"fa-trash":t,"fa-undo":r,"fa-spinner fa-pulse":e});function oe(t,r){t&1&&(a(0,"div",12),B(1,"i",13),o(),a(2,"p",14),l(3),d(4,"translate"),o()),t&2&&(s(3),g(m(4,1,"reset.no_accessories")))}function re(t,r){if(t&1&&(a(0,"option",24),l(1),o()),t&2){let e=r.$implicit;b("value",e._id),s(),L("",e.name," (",e._username,")")}}function le(t,r){if(t&1){let e=S();a(0,"li",20),l(1),d(2,"translate"),o(),a(3,"li",18)(4,"label",21),l(5),d(6,"translate"),o(),a(7,"div",22)(8,"select",23),j("ngModelChange",function(i){f(e);let _=c(2);return P(_.selectedBridge,i)||(_.selectedBridge=i),C(i)}),h("change",function(i){f(e);let _=c(2);return C(_.onBridgeChange(i.target.value))}),E(9,re,2,3,"option",24,k),o()()()}if(t&2){let e=c(2);s(),g(m(2,3,"form.label.changes_kept")),s(4),g(m(6,5,"reset.accessory_ind.bridge")),s(3),N("ngModel",e.selectedBridge),s(),T(e.pairings)}}function ce(t,r){if(t&1&&(a(0,"li",18)(1,"label",25),l(2),d(3,"translate"),o(),a(4,"div",26),l(5),o()()),t&2){let e=c(2);s(2),g(m(3,2,"reset.accessory_ind.bridge")),s(3),I(" ",e.getCurrentlySelectedBridge()," ")}}function de(t,r){if(t&1){let e=S();a(0,"li",19)(1,"span"),l(2),B(3,"br"),a(4,"small")(5,"span",27),l(6),o()()(),a(7,"button",28),d(8,"translate"),h("click",function(){let i=f(e).$implicit,_=c(2);return C(_.toggleList(i.UUID,i.$cacheFile))}),B(9,"i",29),o()()}if(t&2){let e=r.$implicit,n=c(2);s(2),I(" ",e.displayName,""),s(4),g(e.UUID),s(),b("disabled",n.clicked)("ngClass",O(8,se,!n.isInList(e.UUID,e.$cacheFile),n.isInList(e.UUID,e.$cacheFile))),$("aria-label",m(8,6,"form.button_delete")),s(2),b("ngClass",W(11,ae,!n.isInList(e.UUID,e.$cacheFile),n.isInList(e.UUID,e.$cacheFile)&&!n.clicked,n.isInList(e.UUID,e.$cacheFile)&&n.clicked))}}function me(t,r){if(t&1&&(a(0,"div",12),B(1,"i",15),o(),a(2,"ul",16)(3,"li"),l(4),d(5,"translate"),o(),a(6,"li"),l(7),d(8,"translate"),o(),a(9,"li"),l(10),d(11,"translate"),o()(),a(12,"ul",17),x(13,le,11,7)(14,ce,6,4,"li",18),E(15,de,10,15,"li",19,k),o()),t&2){let e=c();s(4),g(m(5,5,"reset.accessory_ind.list_1")),s(3),g(m(8,7,"reset.accessory_ind.list_2")),s(3),g(m(11,9,"reset.accessory_ind.list_3")),s(3),u(e.pairings.length>1?13:-1),s(),u(e.pairings.length===1?14:-1),s(),T(e.selectedBridgeAccessories)}}function pe(t,r){if(t&1){let e=S();a(0,"button",30),h("click",function(){f(e);let i=c();return C(i.$activeModal.dismiss("Dismiss"))}),l(1),d(2,"translate"),o()}if(t&2){let e=c();b("disabled",e.clicked),s(),I(" ",m(2,2,"form.button_close")," ")}}function _e(t,r){if(t&1){let e=S();a(0,"button",31),h("click",function(){f(e);let i=c();return C(i.$activeModal.dismiss("Dismiss"))}),l(1),d(2,"translate"),o()}t&2&&(s(),I(" ",m(2,1,"form.button_close")," "))}function ue(t,r){if(t&1&&l(0),t&2){let e=c(3);I(" (",e.toDelete.length,") ")}}function ge(t,r){if(t&1&&(l(0),d(1,"translate"),x(2,ue,1,1)),t&2){let e=c(2);I(" ",m(1,2,"form.button_remove")," "),s(2),u(e.toDelete.length>0?2:-1)}}function xe(t,r){t&1&&B(0,"i",33)}function ve(t,r){if(t&1){let e=S();a(0,"button",32),h("click",function(){f(e);let i=c();return C(i.removeAccessories())}),x(1,ge,3,4)(2,xe,1,0,"i",33),o()}if(t&2){let e=c();b("disabled",!e.toDelete.length||e.clicked),s(),u(e.clicked?-1:1),s(),u(e.clicked?2:-1)}}var Te=(()=>{class t{$activeModal=w(X);$api=w(ie);$router=w(te);$toastr=w(ee);$translate=w(Y);pairings=[];selectedBridge="";clicked=!1;selectedBridgeAccessories=[];accessoriesExist=!1;toDelete=[];constructor(){}ngOnInit(){this.loadCachedAccessories()}loadCachedAccessories(){return F(this,null,function*(){var e;try{let[n,i]=yield Promise.all([A(this.$api.get("/server/cached-accessories")),A(this.$api.get("/server/pairings"))]),_=new Map(i.map(p=>[p._id,V(M({},p),{accessories:[]})]));n.sort((p,v)=>p.displayName.localeCompare(v.displayName)).forEach(p=>{var D,R;let v=i.find(ne=>ne._main),y=((R=(D=p.$cacheFile)==null?void 0:D.split("."))==null?void 0:R[1])||v._id;(!this.selectedBridge||this.selectedBridge===y)&&(_.has(y)||_.set(y,{_id:y,_username:y.match(/.{1,2}/g).join(":"),name:this.$translate.instant("reset.accessory_ind.unknown"),accessories:[]}),_.get(y).accessories.push(p))}),this.pairings=Array.from(_.values()).filter(p=>p.accessories.length>0).sort((p,v)=>p._main&&!v._main?-1:!p._main&&v._main?1:p.name.localeCompare(v.name)),this.selectedBridge=this.selectedBridge||((e=this.pairings[0])==null?void 0:e._id),this.selectedBridge&&(this.accessoriesExist=!0,this.selectedBridgeAccessories=this.pairings[0].accessories)}catch(n){console.error(n),this.$toastr.error(this.$translate.instant("reset.error_message"),this.$translate.instant("toast.title_error")),this.$activeModal.close()}})}onBridgeChange(e){var n;this.selectedBridge=e,this.selectedBridgeAccessories=(n=this.pairings.find(i=>i._id===this.selectedBridge))==null?void 0:n.accessories}getCurrentlySelectedBridge(){let e=this.pairings.find(n=>n._id===this.selectedBridge);return`${e.name} - ${e._username}`}toggleList(e,n){this.toDelete.some(i=>i.uuid===e&&i.cacheFile===n)?this.toDelete=this.toDelete.filter(i=>i.uuid!==e&&i.cacheFile!==n):this.toDelete.push({cacheFile:n,uuid:e})}isInList(e,n){return this.toDelete.some(i=>i.uuid===e&&i.cacheFile===n)}removeAccessories(){return this.clicked=!0,this.$api.delete("/server/cached-accessories",{body:this.toDelete}).subscribe({next:()=>{this.$toastr.success(this.$translate.instant("reset.accessory_ind.done"),this.$translate.instant("toast.title_success")),this.$activeModal.close(),this.$router.navigate(["/restart"],{queryParams:{restarting:!0}})},error:e=>{this.clicked=!1,console.error(e),this.$toastr.error(this.$translate.instant("reset.accessory_ind.fail"),this.$translate.instant("toast.title_error"))}})}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=U({type:t,selectors:[["ng-component"]],inputs:{selectedBridge:"selectedBridge"},decls:17,vars:12,consts:[[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","data-bs-dismiss","modal",1,"btn-close",3,"click","disabled"],[1,"modal-body"],[1,"modal-footer","justify-content-between"],[1,"text-start"],["type","button","data-bs-dismiss","modal",1,"btn","btn-elegant",3,"disabled"],[1,"text-center"],["type","button","data-bs-dismiss","modal",1,"btn","btn-elegant"],[1,"text-end"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"disabled"],[1,"text-center","mb-3"],[1,"fas","fa-fw","fa-circle-check","primary-text",2,"font-size","75px"],[1,"mb-0","text-center"],[1,"fas","fa-fw","fa-network-wired","primary-text",2,"font-size","75px"],[1,"mb-3"],[1,"list-group","list-group-box","mb-0"],[1,"list-group-item","d-flex","flex-column","flex-md-row","align-items-center"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"list-group-item","text-center","grey-text","small"],["for","bridgeSelect",1,"mb-2","mb-md-0","w-100","w-md-50"],[1,"text-start","text-md-end","w-100","w-md-50"],["id","bridgeSelect",1,"custom-select",3,"ngModelChange","change","ngModel"],[3,"value"],[1,"mb-2","mb-md-0","w-100","w-md-50"],[1,"text-start","text-md-end","w-100","w-md-50","grey-text","font-monospace"],[1,"font-monospace","grey-text"],[1,"btn","btn-danger","m-0","ms-3",3,"click","disabled","ngClass"],[1,"fas","fa-fw",3,"ngClass"],["type","button","data-bs-dismiss","modal",1,"btn","btn-elegant",3,"click","disabled"],["type","button","data-bs-dismiss","modal",1,"btn","btn-elegant",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-fw","fa-spinner","fa-pulse"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"h5",2),l(3),d(4,"translate"),o(),a(5,"button",3),d(6,"translate"),h("click",function(){return i.$activeModal.dismiss("Dismiss")}),o()(),a(7,"div",4),x(8,oe,5,3)(9,me,17,11),o(),a(10,"div",5)(11,"div",6),x(12,pe,3,4,"button",7),o(),a(13,"div",8),x(14,_e,3,3,"button",9),o(),a(15,"div",10),x(16,ve,3,3,"button",11),o()()()),n&2&&(s(3),g(m(4,8,"reset.accessory_ind.title")),s(2),b("disabled",i.clicked),$("aria-label",m(6,10,"form.button_close")),s(3),u(i.accessoriesExist?-1:8),s(),u(i.accessoriesExist?9:-1),s(3),u(i.accessoriesExist?12:-1),s(2),u(i.accessoriesExist?-1:14),s(2),u(i.accessoriesExist?16:-1))},dependencies:[z,Z,Q,J,K,H,q,G],encapsulation:2})}return t})();export{Te as a};
