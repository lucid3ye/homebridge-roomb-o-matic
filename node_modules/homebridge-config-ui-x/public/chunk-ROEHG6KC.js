import{c as N,d as w,e as T,f as O,g as q,j as x,m as G,p as Q,q as z,w as D,y as H,z as j}from"./chunk-CZTEBDJ7.js";import{d as W}from"./chunk-3M4FKD4C.js";import{c as K}from"./chunk-Y6JDUN44.js";import{b as J}from"./chunk-IOMYKUG2.js";import{j as U}from"./chunk-IIKCB2AW.js";import{b as A}from"./chunk-IJXZOFF2.js";import{Ac as l,Jb as p,M as $,Ob as c,Tb as r,Ub as a,Vb as m,_c as M,ac as L,bc as I,bd as R,gb as o,h as b,ic as v,jc as P,lc as d,ma as g,mc as C,nc as B,pb as h,sb as k,vc as f,w as V,yb as S,zc as s}from"./chunk-N5DHAEO2.js";var X=["password"],Y=["username"],Z=["otp"],ee=e=>({background:e}),E=e=>({"is-invalid":e});function te(e,_){if(e&1&&(r(0,"div",10)(1,"span",11),m(2,"i",12),a(),m(3,"input",13,0),s(5,"translate"),a(),r(6,"div",14)(7,"span",11),m(8,"i",15),a(),m(9,"input",16,1),s(11,"translate"),a()),e&2){let t=I();o(3),p("placeholder",l(5,4,"users.label_username"))("ngClass",f(8,E,t.form.controls.username.dirty&&t.form.controls.username.errors)),o(6),p("placeholder",l(11,6,"users.label_password"))("ngClass",f(10,E,t.form.controls.password.dirty&&t.form.controls.password.errors))}}function ne(e,_){if(e&1&&(r(0,"p",7),d(1),s(2,"translate"),a(),r(3,"div",14)(4,"span",11),m(5,"i",17),a(),m(6,"input",18,2),s(8,"translate"),a()),e&2){let t=I();o(),C(l(2,3,"users.setup_2fa_enter_code")),o(5),p("placeholder",l(8,5,"login.label_2fa_code"))("ngClass",f(7,E,t.form.controls.otp.dirty&&t.form.controls.otp.errors))}}function ie(e,_){e&1&&(r(0,"p",8)(1,"small"),d(2),s(3,"translate"),a()()),e&2&&(o(2),C(l(3,1,"login.invalid_credentials")))}function oe(e,_){e&1&&(r(0,"p",8)(1,"small"),d(2),s(3,"translate"),a()()),e&2&&(o(2),C(l(3,1,"login.message_invalid_2fa_code")))}var Ce=(()=>{class e{$auth=g(K);$router=g(W);$settings=g(J);passwordInput=h("password");usernameInput=h("username");otpInput=h("otp");form;backgroundStyle;invalidCredentials=!1;invalid2faCode=!1;twoFactorCodeRequired=!1;inProgress=!1;targetRoute;constructor(){}ngOnInit(){this.form=new q({username:new x(""),password:new x("")}),this.form.valueChanges.pipe($(500)).subscribe(t=>{var n;let i=(n=this.passwordInput())==null?void 0:n.nativeElement.value;i&&i!==t.password&&this.form.controls.password.setValue(i)}),this.targetRoute=window.sessionStorage.getItem("target_route")||"",this.setBackground()}setBackground(){return b(this,null,function*(){if(this.$settings.settingsLoaded||(yield V(this.$settings.onSettingsLoaded)),this.$settings.env.customWallpaperHash){let t=this.$settings.env.customWallpaperHash?`${U.api.base}/auth/wallpaper/${this.$settings.env.customWallpaperHash}`:"/assets/snapshot.jpg";this.backgroundStyle=`url('${t}') center/cover`}})}onSubmit(){return b(this,null,function*(){var n,y,F;this.invalidCredentials=!1,this.invalid2faCode=!1,this.inProgress=!0;let t=(n=this.passwordInput())==null?void 0:n.nativeElement.value;t&&t!==this.form.get("password").value&&this.form.controls.password.setValue(t);let i=(y=this.usernameInput())==null?void 0:y.nativeElement.value;if(i&&i!==this.form.get("username").value&&this.form.controls.username.setValue(i),this.twoFactorCodeRequired){let u=(F=this.otpInput())==null?void 0:F.nativeElement.value;u&&u!==this.form.get("otp").value&&this.form.controls.username.setValue(u)}yield this.$auth.login(this.form.getRawValue()).then(()=>{this.$router.navigateByUrl(this.targetRoute),window.sessionStorage.removeItem("target_route")}).catch(u=>{u.status===412?(this.form.controls.otp?(this.form.controls.otp.setErrors(["Invalid Code"]),this.invalid2faCode=!0):this.form.addControl("otp",new x("",[w.required,w.minLength(6),w.maxLength(6)])),this.twoFactorCodeRequired=!0,setTimeout(()=>{document.getElementById("form-ota").focus()},100)):this.invalidCredentials=!0}),this.inProgress=!1})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=k({type:e,selectors:[["ng-component"]],viewQuery:function(i,n){i&1&&(v(n.passwordInput,X,5),v(n.usernameInput,Y,5),v(n.otpInput,Z,5)),i&2&&P(3)},decls:13,vars:12,consts:[["username",""],["password",""],["otp",""],[1,"login-container","d-flex","align-items-center","justify-content-center",3,"ngStyle"],[1,"card","card-body","mx-2","login-card"],["novalidate","",3,"ngSubmit","formGroup"],[1,"h4","text-center","mb-4"],[1,"text-center"],[1,"red-text"],["tabindex","3","type","submit",1,"btn","btn-primary",3,"disabled"],[1,"md-form","input-group","mb-3"],[1,"input-group-text","custom-input"],[1,"fas","fa-fw","fa-user","prefix","grey-text"],["formControlName","username","type","text","id","form-username","autofocus","","autocomplete","username","autocapitalize","none","tabindex","1",1,"form-control","custom-input","py-2",3,"placeholder","ngClass"],[1,"md-form","input-group","mb-4"],[1,"fas","fa-fw","fa-lock","prefix","grey-text"],["formControlName","password","type","password","id","form-pass","autocomplete","current-password","tabindex","2",1,"form-control","custom-input","py-2",3,"placeholder","ngClass"],[1,"fas","fa-fw","fa-key","prefix","grey-text"],["formControlName","otp","type","text","id","form-ota","autocomplete","one-time-code","autocapitalize","none","inputmode","numeric","pattern","[0-9]*","tabindex","1",1,"form-control","custom-input","py-2",3,"placeholder","ngClass"]],template:function(i,n){i&1&&(r(0,"div",3)(1,"div",4)(2,"form",5),L("ngSubmit",function(){return n.onSubmit()}),r(3,"p",6),d(4,"Homebridge"),a(),S(5,te,12,12)(6,ne,9,9),r(7,"div",7),S(8,ie,4,3,"p",8)(9,oe,4,3,"p",8),r(10,"button",9),d(11),s(12,"translate"),a()()()()()),i&2&&(p("ngStyle",f(10,ee,n.backgroundStyle)),o(2),p("formGroup",n.form),o(3),c(n.twoFactorCodeRequired?-1:5),o(),c(n.twoFactorCodeRequired?6:-1),o(2),c(n.invalidCredentials?8:-1),o(),c(n.invalid2faCode?9:-1),o(),p("disabled",n.form.invalid),o(),B(" ",l(12,8,"login.button_login")," "))},dependencies:[R,H,G,N,T,O,D,j,Q,z,M,A],styles:[".login-container[_ngcontent-%COMP%]{background-color:#f4f4f4;background-size:cover;position:absolute;top:0;bottom:0;right:0;left:0}.login-card[_ngcontent-%COMP%]{max-width:500px;background-color:#ffffffe6}@media screen and (min-height: 800px){.login-card[_ngcontent-%COMP%]{margin-bottom:12em}}.login-logo[_ngcontent-%COMP%]{position:absolute;top:-35%;z-index:2000;max-width:450px}@media screen and (max-width: 450px){.login-logo[_ngcontent-%COMP%]{max-width:320px;top:-25%}}@media screen and (max-width: 320px){.login-logo[_ngcontent-%COMP%]{max-width:280px}}@media screen and (max-height: 450px){.login-logo[_ngcontent-%COMP%]{display:none}}"]})}return e})();export{Ce as a};
